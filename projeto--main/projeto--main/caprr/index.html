<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SocialHub - Conta nova de Ítalo Paulo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --brand-start: #7c3aed; --brand-end: #06b6d4; }
    html, body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif; }
    .card { box-shadow: 0 8px 28px rgba(2, 6, 23, 0.08); border: 1px solid rgba(2, 6, 23, 0.06); backdrop-filter: saturate(1.1); }
    .brand-gradient { background: linear-gradient(135deg, var(--brand-start), var(--brand-end)); }
    .brand-text { background: linear-gradient(135deg, var(--brand-start), var(--brand-end)); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .online-dot { background: #22c55e; box-shadow: 0 0 0 2px #fff; }
    .ring-brand:focus { outline: none; box-shadow: 0 0 0 3px rgba(124, 58, 237, .25), 0 0 0 6px rgba(6, 182, 212, .15); }
    .scroll-slim { scrollbar-width: thin; scrollbar-color: rgba(15,23,42,.3) transparent; }
    .scroll-slim::-webkit-scrollbar { height: 8px; width: 8px; }
    .scroll-slim::-webkit-scrollbar-thumb { background: rgba(2,6,23,.25); border-radius: 9999px; }
    .fade-in { animation: fade .25s ease-out; }
    @keyframes fade { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    .pop { animation: pop .18s ease-out; }
    @keyframes pop { from { transform: scale(.96); } to { transform: scale(1); } }
    .ping-dot::after { content: ""; position: absolute; inset: -4px; border-radius: 9999px; border: 2px solid #ef4444; animation: ping 1.6s cubic-bezier(0, 0, .2, 1) infinite; opacity: .75; }
    @keyframes ping { 75%, 100% { transform: scale(1.6); opacity: 0; } }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100">
  <!-- Header -->
  <header class="sticky top-0 z-50 backdrop-blur bg-slate-900/70 border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center justify-between py-4">
        <div class="flex items-center gap-3">
          <div class="brand-gradient p-2 rounded-xl shadow-md">
            <svg class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 3a9 9 0 00-9 9c0 1.9.59 3.66 1.6 5.11L3 21l3.04-1.56A8.98 8.98 0 0012 21a9 9 0 100-18zm-3 10h6a1 1 0 010 2H9a1 1 0 010-2zm0-4h9a1 1 0 010 2H9a1 1 0 010-2z"/>
            </svg>
          </div>
          <h1 class="text-2xl font-extrabold tracking-tight"><span class="brand-text">SocialHub</span></h1>
        </div>

        <!-- Busca -->
        <div class="flex-1 max-w-xl mx-6 hidden md:block">
          <div class="relative">
            <input id="searchInput" type="text" placeholder="Pesquisar pessoas, posts..."
                   class="w-full bg-white/10 placeholder-white/60 text-white rounded-full py-2.5 pl-11 pr-11 border border-white/10 focus:border-white/20 ring-brand transition">
            <button id="searchIconBtn" class="absolute left-2 top-1.5 p-1.5 rounded-full hover:bg-white/10" type="button" title="Buscar">
              <svg class="w-5 h-5 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M17 10a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </button>
            <!-- Dropdown de resultados -->
            <div id="searchResults" class="hidden absolute z-50 mt-2 left-0 right-0 bg-slate-900/95 backdrop-blur border border-white/10 rounded-2xl shadow-xl overflow-hidden">
              <div class="p-3 text-sm text-white/60">Digite para encontrar pessoas…</div>
            </div>
          </div>
        </div>

        <!-- Ações -->
        <div class="flex items-center gap-2">
          <button id="btnExplore" class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-white/90 transition">Explorar</button>
          <button id="btnMessages" class="relative p-2 rounded-full hover:bg-white/10 transition" title="Mensagens">
            <svg class="w-6 h-6 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </button>
          <button id="btnNotifications" class="relative p-2 rounded-full hover:bg-white/10 transition" title="Notificações">
            <svg class="w-6 h-6 text-white/90" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 19h11a2 2 0 002-2V7a2 2 0 00-2-2H4a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <span id="notificationBadge" class="absolute -top-1.5 -right-1.5 w-5 h-5 text-xs font-bold rounded-full bg-red-500 text-white grid place-items-center ping-dot">0</span>
          </button>
          <div class="relative">
            <button id="btnProfile" class="flex items-center gap-2 rounded-full hover:bg-white/10 p-1.5 transition">
              <div class="relative">
                <button id="btnProfileAvatar" data-action="open-profile" data-handle="@voce" class="w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-cyan-500 grid place-items-center text-white font-bold">IP</button>
                <span class="online-dot absolute bottom-0 right-0 w-3 h-3 rounded-full"></span>
              </div>
              <span class="hidden sm:block text-white/90 font-semibold" data-action="open-profile" data-handle="@voce">Ítalo Paulo</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Botão Voltar -->
  <button id="backArrow" class="hidden fixed top-4 left-4 z-[60] p-2 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white shadow transition" title="Voltar">
    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
    </svg>
  </button>

  <!-- Conteúdo -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Sidebar Esquerda -->
      <aside class="lg:col-span-1 space-y-6">
        <section class="card rounded-2xl p-5 bg-slate-900/60">
          <button data-action="open-profile" data-handle="@voce" class="flex items-center gap-4 text-left w-full hover:bg-white/5 rounded-xl p-2 transition">
            <div class="relative">
              <div class="w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-cyan-500 grid place-items-center text-white font-bold text-lg">IP</div>
              <span class="online-dot absolute bottom-0 right-0 w-3.5 h-3.5 rounded-full"></span>
            </div>
            <div>
              <h2 class="font-bold text-white hover:underline">Ítalo Paulo</h2>
              <p class="text-sm text-white/70 hover:underline">@voce</p>
            </div>
          </button>
          <div class="grid grid-cols-3 gap-3 mt-5 text-center">
            <div class="bg-white/5 rounded-xl p-3">
              <div id="sidebarFollowersCount" class="text-white font-bold">0</div>
              <div class="text-xs text-white/60">Seguidores</div>
            </div>
            <div class="bg-white/5 rounded-xl p-3">
              <div id="sidebarFollowingCount" class="text-white font-bold">0</div>
              <div class="text-xs text-white/60">Seguindo</div>
            </div>
            <div class="bg-white/5 rounded-xl p-3">
              <div id="sidebarPostsCount" class="text-white font-bold">0</div>
              <div class="text-xs text-white/60">Posts</div>
            </div>
          </div>
          <div class="mt-5 grid grid-cols-2 gap-2">
            <button class="w-full bg-white/10 hover:bg-white/15 active:bg-white/20 text-white font-semibold py-2.5 rounded-xl transition">Editar perfil</button>
            <button id="viewOwnProfile" class="w-full brand-gradient hover:brightness-110 active:brightness-95 text-white font-semibold py-2.5 rounded-xl transition">Ver perfil</button>
          </div>
        </section>

        <!-- Atalhos -->
        <section class="card rounded-2xl p-5 bg-slate-900/60">
          <h3 class="font-semibold text-white mb-3">Atalhos</h3>
          <ul class="space-y-2 text-white/90">
            <li><button id="shortcutExplore" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition">Explorar perfis</button></li>
            <li><button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition">Amigos</button></li>
            <li><button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition">Grupos</button></li>
            <li><button class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition">Eventos</button></li>
          </ul>
        </section>
      </aside>

      <!-- Coluna Central -->
      <section class="lg:col-span-2 space-y-6" id="mainColumn">
        <!-- Explorar Perfis -->
        <div id="exploreView" class="hidden space-y-4">
          <div class="card rounded-2xl p-5 bg-slate-900/60">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <h2 class="text-xl font-bold">Explorar perfis</h2>
              <div class="flex gap-2">
                <input id="exploreSearch" type="text" placeholder="Buscar por nome ou @"
                  class="w-full sm:w-64 bg-white/10 text-white placeholder-white/60 rounded-xl py-2 px-3 border border-white/10 focus:border-white/20 ring-brand"/>
                <button id="exploreClear" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15">Limpar</button>
              </div>
            </div>
          </div>
          <div class="card rounded-2xl p-4 bg-slate-900/60">
            <div id="exploreGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
            <div class="mt-4 text-center">
              <button id="exploreLoadMore" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15">Carregar mais</button>
            </div>
          </div>
        </div>

        <!-- Perfil (dinâmico) -->
        <div id="profileView" class="hidden space-y-4">
          <div class="card rounded-2xl p-5 bg-slate-900/60">
            <div class="flex items-start gap-4">
              <div id="profileAvatar" class="w-16 h-16 rounded-full grid place-items-center text-white font-bold bg-gradient-to-br from-purple-500 to-cyan-500">IP</div>
              <div class="flex-1">
                <div class="flex flex-wrap items-center justify-between gap-3">
                  <div>
                    <h2 id="profileName" class="text-xl font-bold text-white">Ítalo Paulo</h2>
                    <p id="profileHandle" class="text-white/70 text-sm">@voce</p>
                  </div>
                  <div class="flex gap-2">
                    <button id="profileFollowBtn" class="bg-white/20 text-white font-semibold px-4 py-2 rounded-xl hover:brightness-110 active:brightness-95 transition">Seguir</button>
                    <button id="backToFeed" class="bg-white/10 hover:bg-white/15 text-white font-semibold px-4 py-2 rounded-xl transition">Voltar</button>
                  </div>
                </div>
                <p id="profileBio" class="mt-3 text-white/90">Olá! Acabei de chegar no SocialHub.</p>
                <div class="mt-4 grid grid-cols-3 gap-3 text-center">
                  <div class="bg-white/5 rounded-xl p-3">
                    <div id="profileFollowers" class="text-white font-bold">0</div>
                    <div class="text-xs text-white/60">Seguidores</div>
                  </div>
                  <div class="bg-white/5 rounded-xl p-3">
                    <div id="profileFollowing" class="text-white font-bold">Não segue</div>
                    <div class="text-xs text-white/60">Seguindo</div>
                  </div>
                  <div class="bg-white/5 rounded-xl p-3">
                    <div id="profilePostsCount" class="text-white font-bold">0</div>
                    <div class="text-xs text-white/60">Posts</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card rounded-2xl p-5 bg-slate-900/60">
            <h3 class="font-semibold text-white mb-3">Postagens</h3>
            <div id="profilePosts" class="space-y-5"></div>
          </div>
        </div>

        <!-- Criar Post -->
        <div id="composerCard" class="card rounded-2xl p-5 bg-slate-900/60">
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-cyan-500 grid place-items-center text-white font-bold">IP</div>
            <div class="flex-1">
              <textarea id="composer" rows="3" placeholder="Escreva seu primeiro post..."
                        class="w-full bg-white/5 text-white placeholder-white/60 rounded-xl p-3 border border-white/10 focus:border-white/20 ring-brand transition resize-y"></textarea>
              <div class="flex items-center justify-between mt-3">
                <div class="flex items-center gap-2">
                  <button class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-white/90 transition">🖼️ Imagem</button>
                  <button class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-white/90 transition">📅 Evento</button>
                  <button class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-white/90 transition">👥 Marcar</button>
                </div>
                <div class="flex items-center gap-3">
                  <span id="charCount" class="text-xs text-white/60">0/280</span>
                  <button id="btnPublish" class="brand-gradient text-white font-semibold px-4 py-2 rounded-xl hover:brightness-110 active:brightness-95 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>Publicar</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Aviso do Feed -->
        <div id="feedNotice" class="hidden bg-emerald-500/10 text-emerald-300 border border-emerald-400/20 rounded-xl p-3 text-sm">
          Mostrando também posts de quem você segue.
        </div>

        <!-- Feed -->
        <div id="feed" class="space-y-5"></div>
      </section>

      <!-- Sidebar Direita -->
      <aside class="lg:col-span-1 space-y-6">
        <section class="card rounded-2xl p-5 bg-slate-900/60">
          <h3 class="font-semibold text-white mb-3">Tendências</h3>
          <ul class="space-y-3">
            <li class="flex items-start gap-3"><span class="text-cyan-400">#</span><div><p class="font-semibold">TechWeek2025</p><p class="text-xs text-white/60">42.3k menções</p></div></li>
            <li class="flex items-start gap-3"><span class="text-cyan-400">#</span><div><p class="font-semibold">FotografiaMóvel</p><p class="text-xs text-white/60">18.9k menções</p></div></li>
            <li class="flex items-start gap-3"><span class="text-cyan-400">#</span><div><p class="font-semibold">CaféPerfeito</p><p class="text-xs text-white/60">12.1k menções</p></div></li>
          </ul>
        </section>

        <section class="card rounded-2xl p-5 bg-slate-900/60">
          <h3 class="font-semibold text-white mb-3">Sugestões para seguir</h3>
          <div id="suggestions" class="space-y-3"></div>
          <div class="mt-4 p-3 rounded-xl bg-white/5">
            <p class="text-sm text-white/80 mb-2">Quem começou a seguir você</p>
            <div id="followersList" class="space-y-2"></div>
          </div>
        </section>
      </aside>
    </div>
  </main>

  <!-- Painel de Mensagens -->
  <div id="panelMessages" class="fixed inset-y-0 right-0 w-full max-w-md translate-x-full transition-transform duration-300 z-50">
    <div class="h-full flex flex-col bg-slate-900/95 backdrop-blur border-l border-white/10">
      <div class="p-4 flex items-center justify-between border-b border-white/10">
        <h3 class="font-bold text-white">Mensagens</h3>
        <button class="p-2 rounded-full hover:bg-white/10" onclick="togglePanel('panelMessages', false)">✖</button>
      </div>
      <div class="p-4 space-y-3 overflow-y-auto scroll-slim" id="messagesList">
        <div class="text-center text-white/70 bg-white/5 rounded-xl p-6">Sem mensagens ainda.</div>
      </div>
      <div class="mt-auto p-4 border-t border-white/10">
        <div class="flex items-center gap-2">
          <input id="msgInput" type="text" placeholder="Escreva uma mensagem..." class="flex-1 bg-white/10 text-white placeholder-white/60 rounded-xl py-2 px-3 border border-white/10 focus:border-white/20 ring-brand">
          <button id="sendMsg" class="brand-gradient text-white font-semibold px-4 py-2 rounded-xl hover:brightness-110 active:brightness-95 transition">Enviar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Painel de Notificações -->
  <div id="panelNotifications" class="fixed inset-y-0 right-0 w-full max-w-md translate-x-full transition-transform duration-300 z-50">
    <div class="h-full flex flex-col bg-slate-900/95 backdrop-blur border-l border-white/10">
      <div class="p-4 flex items-center justify-between border-b border-white/10">
        <h3 class="font-bold text-white">Notificações</h3>
        <button class="p-2 rounded-full hover:bg-white/10" onclick="togglePanel('panelNotifications', false)">✖</button>
      </div>
      <div id="notificationsList" class="p-4 space-y-3 overflow-y-auto scroll-slim"></div>
      <div class="p-4 border-t border-white/10 bg-slate-900/70">
        <div class="flex items-center justify-between">
          <span class="text-white/80">Seguir quem me seguiu</span>
          <button id="btnFollowBackAll" class="px-3 py-1.5 rounded-lg brand-gradient text-white font-semibold hover:brightness-110 active:brightness-95 transition">Seguir todos</button>
        </div>
      </div>
      <div class="mt-auto p-4 border-t border-white/10">
        <button id="markAllRead" class="w-full bg-white/10 hover:bg-white/15 text-white font-semibold py-2.5 rounded-xl transition">Marcar tudo como lido</button>
      </div>
    </div>
  </div>

  <script>
    // Estado
    const state = {
      charLimit: 280,
      users: {
        '@voce': { name: 'Ítalo Paulo', handle: '@voce', initials: 'IP', color: ['from-purple-500','to-cyan-500'], bio: 'Olá! Acabei de chegar no SocialHub.', followers: 0, following: false }
      },
      posts: [],          // seus posts
      globalPosts: [],    // posts dos outros (para o feed quando você segue)
      suggestions: [],    // sugestões curtas
      notifications: [],
      unread: 0,
      messages: [],
      explore: {
        allHandles: [],   // todos os @ gerados (exceto @voce)
        filtered: [],
        page: 0,
        pageSize: 36
      }
    };

    const el = (s, r=document) => r.querySelector(s);

    // Sidebar
    function updateSidebarCounts() {
      const me = state.users['@voce'];
      el('#sidebarFollowersCount').textContent = new Intl.NumberFormat('pt-BR').format(me.followers || 0);
      const followingCount = Object.entries(state.users).filter(([h,u]) => h!=='@voce' && u.following).length;
      el('#sidebarFollowingCount').textContent = new Intl.NumberFormat('pt-BR').format(followingCount);
      el('#sidebarPostsCount').textContent = new Intl.NumberFormat('pt-BR').format(state.posts.length);
    }

    function updateFollowersUI() {
      const me = state.users['@voce'];
      const count = me?.followers || 0;
      const sidebarFollowers = el('#sidebarFollowersCount');
      if (sidebarFollowers) sidebarFollowers.textContent = new Intl.NumberFormat('pt-BR').format(count);
      const profileView = el('#profileView');
      if (profileView && !profileView.classList.contains('hidden') && el('#profileHandle')?.textContent === '@voce') {
        const pf = el('#profileFollowers');
        if (pf) pf.textContent = new Intl.NumberFormat('pt-BR').format(count);
      }
    }

    // Feed
    function renderFeed() {
      const feed = el('#feed');
      feed.innerHTML = '';

      // Quem você segue (sempre inclui você)
      const followed = Object.entries(state.users).filter(([h,u]) => h!=='@voce' && u.following).map(([h])=>h);
      if (!followed.includes('@voce')) followed.push('@voce');

      // Posts externos só dos perfis seguidos
      const external = state.globalPosts.filter(p => followed.includes(p.author.handle));
      const all = [...state.posts, ...external];

      // Aviso quando estiver seguindo alguém
      el('#feedNotice').classList.toggle('hidden', followed.length <= 1);

      if (all.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'text-center text-white/80 bg-white/5 rounded-xl p-6';
        empty.textContent = 'Seu feed está vazio. Siga pessoas e/ou publique algo para ver novidades!';
        feed.appendChild(empty);
        return;
      }

      all.forEach(post => {
        const likedClass = post.liked ? 'bg-white/20 text-white' : 'bg-white/10 text-white/90';
        const likeIcon = post.liked ? '❤️' : '🤍';
        const card = document.createElement('article');
        card.className = 'card rounded-2xl p-5 bg-slate-900/60 fade-in';
        card.setAttribute('data-id', post.id);
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <button data-action="open-profile" data-handle="${post.author.handle}" class="w-11 h-11 rounded-full bg-gradient-to-br ${post.author.color.join(' ')} grid place-items-center text-white font-bold">${post.author.initials}</button>
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <div>
                  <p class="font-semibold text-white"><button data-action="open-profile" data-handle="${post.author.handle}" class="hover:underline">${post.author.name}</button></p>
                  <p class="text-xs text-white/60"><button data-action="open-profile" data-handle="${post.author.handle}" class="hover:underline">${post.author.handle}</button> • ${post.time}</p>
                </div>
                <button class="px-2 py-1 rounded-lg hover:bg-white/10">•••</button>
              </div>
              <p class="mt-3 text-white/90 whitespace-pre-line">${post.text}</p>
              <div class="mt-4 flex items-center gap-2">
                <button data-action="like" class="px-3 py-1.5 rounded-lg ${likedClass} hover:bg-white/20 transition">${likeIcon} <span class="ml-1" data-like-count>${post.likes}</span></button>
                <button data-action="comment-toggle" class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-white/90 transition">💬 Comentários <span class="ml-1 text-white/70">(${post.comments.length})</span></button>
                <button class="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/15 text-white/90 transition">🔗 Compartilhar</button>
              </div>
              <div class="mt-4 ${post.commentsOpen ? '' : 'hidden'}" data-comments>
                <div class="space-y-3" data-comments-list></div>
                <div class="flex items-center gap-2 mt-3">
                  <input type="text" placeholder="Escreva um comentário..." class="flex-1 bg-white/10 text-white placeholder-white/60 rounded-xl py-2 px-3 border border-white/10 focus:border-white/20 ring-brand" data-comment-input>
                  <button data-action="add-comment" class="brand-gradient text-white font-semibold px-3 py-2 rounded-xl hover:brightness-110 active:brightness-95 transition">Enviar</button>
                </div>
              </div>
            </div>
          </div>`;
        feed.appendChild(card);
      });
    }

    // Explorar
    function renderExplore(reset=false) {
      const grid = el('#exploreGrid');
      if (reset) { grid.innerHTML = ''; state.explore.page = 0; }
      const list = (state.explore.filtered.length ? state.explore.filtered : state.explore.allHandles);
      const start = state.explore.page * state.explore.pageSize;
      const items = list.slice(start, start + state.explore.pageSize);

      items.forEach(handle => {
        const u = state.users[handle];
        if (!u) return;
        const card = document.createElement('div');
        card.className = 'bg-white/5 rounded-xl p-3 flex items-center gap-3';
        card.innerHTML = `
          <button data-action="open-profile" data-handle="${u.handle}" class="w-10 h-10 rounded-full bg-gradient-to-br ${u.color.join(' ')} grid place-items-center text-white font-bold text-sm">${u.initials}</button>
          <div class="min-w-0 flex-1">
            <p class="font-semibold text-white truncate"><button data-action="open-profile" data-handle="${u.handle}" class="hover:underline">${u.name}</button></p>
            <p class="text-xs text-white/60 truncate"><button data-action="open-profile" data-handle="${u.handle}" class="hover:underline">${u.handle}</button></p>
          </div>
          <button data-action="follow-user" data-handle="${u.handle}" class="px-3 py-1.5 rounded-lg ${u.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold hover:brightness-110 active:brightness-95 transition">${u.following ? 'Seguindo' : 'Seguir'}</button>
        `;
        grid.appendChild(card);
      });

      state.explore.page++;
      const btnMore = el('#exploreLoadMore');
      btnMore.disabled = (start + items.length) >= list.length;
      btnMore.classList.toggle('opacity-50', btnMore.disabled);
    }

    // Sugestões
    function renderSuggestions() {
      const wrap = el('#suggestions');
      wrap.innerHTML = '';
      const pool = state.explore.allHandles.slice(0).sort(() => Math.random() - 0.5).slice(0,6);
      pool.forEach(handle => {
        const u = state.users[handle];
        if (!u) return;
        const row = document.createElement('div');
        row.className = 'flex items-center gap-3 bg-white/5 rounded-xl p-3';
        row.innerHTML = `
          <button data-action="open-profile" data-handle="${u.handle}" class="w-10 h-10 rounded-full bg-gradient-to-br ${u.color.join(' ')} grid place-items-center text-white font-bold text-sm">${u.initials}</button>
          <div class="flex-1 min-w-0">
            <p class="font-semibold text-white truncate"><button data-action="open-profile" data-handle="${u.handle}" class="hover:underline">${u.name}</button></p>
            <p class="text-xs text-white/60 truncate"><button data-action="open-profile" data-handle="${u.handle}" class="hover:underline">${u.handle}</button></p>
          </div>
          <button data-action="follow-user" data-handle="${u.handle}" class="px-3 py-1.5 rounded-lg ${u.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold hover:brightness-110 active:brightness-95 transition">${u.following ? 'Seguindo' : 'Seguir'}</button>
        `;
        wrap.appendChild(row);
      });
    }

    // Notificações
    function renderNotifications() {
      renderFollowersToFollow();
      const list = el('#notificationsList');
      list.innerHTML = '';
      const hint = document.createElement('div');
      hint.className = 'text-sm text-white/70 bg-white/5 rounded-xl p-3 mb-3';
      hint.textContent = 'Dica: toque em uma notificação para marcar como lida. Use “Seguir todos” para ver os posts dessas pessoas no seu feed.';
      list.appendChild(hint);

      if (state.notifications.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'text-center text-white/70 bg-white/5 rounded-xl p-6';
        empty.textContent = 'Sem notificações no momento.';
        list.appendChild(empty);
      } else {
        state.notifications.forEach(n => {
          const item = document.createElement('div');
          item.className = `flex items-start gap-3 bg-white/5 rounded-xl p-3 ${n.read ? 'opacity-70' : ''}`;
          item.setAttribute('data-id', n.id);
          item.innerHTML = `
            <div class="w-9 h-9 rounded-full bg-gradient-to-br from-purple-500 to-cyan-500 grid place-items-center">🔔</div>
            <div class="flex-1">
              <p class="text-sm text-white/90">${n.text}</p>
              <p class="text-xs text-white/60 mt-1">${n.time}</p>
            </div>
            <button data-action="read-toggle" class="px-2 py-1 rounded-lg bg-white/10 hover:bg-white/15 text-xs">
              ${n.read ? 'Marcar não lida' : 'Marcar lida'}
            </button>`;
          list.appendChild(item);
        });
      }

      const badge = el('#notificationBadge');
      badge.textContent = state.unread;
      badge.style.display = state.unread > 0 ? 'grid' : 'none';
    }

    function renderFollowersToFollow() {
      const box = el('#followersList');
      if (!box) return;
      box.innerHTML = '';
      const followerNotifs = state.notifications.filter(n => n.text.includes('começou a seguir você'));
      const seen = new Set();
      followerNotifs.forEach(n => {
        const who = n.text.replace(' começou a seguir você', '').trim();
        if (seen.has(who)) return; seen.add(who);
        const user = Object.values(state.users).find(u => u.name === who);
        if (!user) return;
        const row = document.createElement('div');
        row.className = 'flex items-center gap-3';
        row.innerHTML = `
          <div class="w-8 h-8 rounded-full bg-gradient-to-br ${user.color.join(' ')} grid place-items-center text-white text-xs font-bold">${user.initials}</div>
          <div class="flex-1">
            <p class="text-sm text-white/90">${user.name} <span class="text-white/50">${user.handle}</span></p>
          </div>
          <button data-handle="${user.handle}" class="px-3 py-1.5 rounded-lg ${user.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold hover:brightness-110 active:brightness-95 transition" data-action="follow-back">${user.following ? 'Seguindo' : 'Seguir'}</button>
        `;
        box.appendChild(row);
      });

      box.onclick = (e) => {
        const btn = e.target.closest('button[data-action="follow-back"]');
        if (!btn) return;
        const handle = btn.getAttribute('data-handle');
        const u = state.users[handle];
        if (!u) return;
        u.following = !u.following;
        btn.textContent = u.following ? 'Seguindo' : 'Seguir';
        btn.className = `px-3 py-1.5 rounded-lg ${u.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold hover:brightness-110 active:brightness-95 transition`;
        updateSidebarCounts();
        renderFeed();
      };
    }

    // Painéis
    function togglePanel(id, force) {
      const panel = el('#' + id);
      const shown = panel.classList.contains('translate-x-0');
      const shouldShow = typeof force === 'boolean' ? force : !shown;
      panel.classList.toggle('translate-x-0', shouldShow);
      panel.classList.toggle('translate-x-full', !shouldShow);
    }

    // Abrir Perfil
    function openProfile(handle) {
      const u = state.users[handle];
      if (!u) return;
      el('#exploreView').classList.add('hidden');
      el('#profileView').classList.remove('hidden');
      el('#composerCard').classList.add('hidden');
      el('#feed').classList.add('hidden');
      el('#backArrow').classList.remove('hidden');

      const avatar = el('#profileAvatar');
      avatar.className = `w-16 h-16 rounded-full grid place-items-center text-white font-bold bg-gradient-to-br ${u.color.join(' ')}`;
      avatar.textContent = u.initials;
      el('#profileName').textContent = u.name;
      el('#profileHandle').textContent = u.handle;
      el('#profileBio').textContent = u.bio || 'Sem bio ainda.';
      el('#profileFollowers').textContent = new Intl.NumberFormat('pt-BR').format(u.followers || 0);
      el('#profileFollowing').textContent = u.following ? 'Você segue' : 'Não segue';

      const postsWrap = el('#profilePosts');
      postsWrap.innerHTML = '';
      const userPosts = [
        ...state.posts.filter(p => p.author.handle === handle),
        ...state.globalPosts.filter(p => p.author.handle === handle)
      ];
      el('#profilePostsCount').textContent = userPosts.length;
      if (userPosts.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'text-center text-white/70 bg-white/5 rounded-xl p-6';
        empty.textContent = 'Ainda sem postagens.';
        postsWrap.appendChild(empty);
      } else {
        userPosts.forEach(p => {
          const card = document.createElement('article');
          card.className = 'card rounded-2xl p-5 bg-slate-900/60 fade-in';
          card.innerHTML = `<p class='text-sm text-white/60 mb-2'>${p.time}</p><p class='text-white/90 whitespace-pre-line'>${p.text}</p>`;
          postsWrap.appendChild(card);
        });
      }

      const btn = el('#profileFollowBtn');
      btn.textContent = u.following ? 'Seguindo' : 'Seguir';
      btn.className = `${u.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold px-4 py-2 rounded-xl hover:brightness-110 active:brightness-95 transition`;
      btn.onclick = () => {
        u.following = !u.following;
        btn.textContent = u.following ? 'Seguindo' : 'Seguir';
        btn.className = `${u.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold px-4 py-2 rounded-xl hover:brightness-110 active:brightness-95 transition`;
        updateSidebarCounts();
        renderFeed();
      };

      el('#backToFeed').onclick = () => {
        el('#profileView').classList.add('hidden');
        el('#composerCard').classList.remove('hidden');
        el('#feed').classList.remove('hidden');
        el('#backArrow').classList.add('hidden');
      };
    }

    // Aleatórios
    function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function pick(arr) { return arr[Math.floor(Math.random()*arr.length)]; }

    function generateRandomUsers(count=2000) {
      const firstNames = ['Ana','Bruno','Camila','Diego','Eduarda','Felipe','Gabriela','Henrique','Isabela','João','Katia','Lucas','Marina','Nina','Otávio','Paula','Rafael','Sofia','Tiago','Vitória','Yuri','Zélia'];
      const lastNames = ['Almeida','Barbosa','Cardoso','Dias','Esteves','Ferreira','Gomes','Henrique','Ivo','Jardim','Leal','Mendes','Nascimento','Oliveira','Prado','Queiroz','Rocha','Souza','Teixeira','Uchoa','Vieira','Xavier','Zanine'];
      const colors = [
        ['from-blue-500','to-cyan-500'], ['from-emerald-500','to-teal-500'], ['from-indigo-500','to-purple-500'],
        ['from-pink-500','to-rose-500'], ['from-amber-500','to-orange-500'], ['from-sky-500','to-blue-500'],
        ['from-lime-500','to-emerald-500'], ['from-violet-500','to-fuchsia-500']
      ];
      const bios = [
        'Amante de café e boas conversas.', 'Design, música e livros.', 'Tecnologia e curiosidades.', 'Fotografia e viagens.',
        'Dev front-end em construção.', 'Minimalismo e produtividade.', 'UX/UI e animações sutis.', 'Esportes e saúde.'
      ];
      const sampleTexts = [
        'Testando ideias novas para 2025. 🚀', 'Começando a semana com café forte! ☕', 'Alguém indica um bom livro?', 'Organizando minha rotina com blocos de tempo. ⏱️',
        'Novo app de notas favorito! 📝', 'Dia lindo para aprender algo novo. 🌤️', 'Explorando micro interações no design. ✨', 'Foco e constância. 💪'
      ];

      // gerar usuários
      for (let i=0; i<count; i++) {
        const fn = pick(firstNames);
        const ln = pick(lastNames);
        const name = `${fn} ${ln}`;
        const handle = '@' + (fn+ln+randomInt(10,9999)).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]/g,'');
        if (state.users[handle]) { i--; continue; }
        const initials = (fn[0]+ln[0]).toUpperCase();
        const color = pick(colors);
        state.users[handle] = { name, handle, initials, color, bio: pick(bios), followers: randomInt(0, 5000), following: false };
      }

      // todos os @ para explorar e sugestões
      state.explore.allHandles = Object.keys(state.users).filter(h => h !== '@voce');

      // posts globais (1–2 de alguns usuários) — usados quando você segue alguém
      let gid = 1;
      state.explore.allHandles.forEach(h => {
        const postCount = Math.random() < 0.25 ? 1 : (Math.random() < 0.07 ? 2 : 0);
        for (let p=0; p<postCount; p++) {
          const u = state.users[h];
          state.globalPosts.push({
            id: 'g'+(gid++),
            author: { name: u.name, handle: u.handle, initials: u.initials, color: u.color },
            time: randomInt(1, 59) + ' min',
            text: pick(sampleTexts),
            likes: randomInt(0, 120),
            liked: false,
            commentsOpen: false,
            comments: []
          });
        }
      });

      renderSuggestions();
    }

    // Eventos
    function setupEvents() {
      // Header
      el('#btnMessages').addEventListener('click', () => togglePanel('panelMessages'));
      el('#btnNotifications').addEventListener('click', () => togglePanel('panelNotifications'));
      el('#btnExplore').addEventListener('click', () => {
        el('#exploreView').classList.remove('hidden');
        el('#profileView').classList.add('hidden');
        el('#feed').classList.remove('hidden');
        el('#composerCard').classList.remove('hidden');
        el('#backArrow').classList.add('hidden');
        renderExplore(true);
      });
      el('#shortcutExplore').addEventListener('click', () => el('#btnExplore').click());

      // Explorar: busca e carregar mais
      el('#exploreSearch').addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase().trim();
        if (!q) { state.explore.filtered = []; renderExplore(true); return; }
        state.explore.filtered = state.explore.allHandles.filter(h => {
          const u = state.users[h];
          return (u.name + ' ' + u.handle).toLowerCase().includes(q);
        });
        renderExplore(true);
      });
      el('#exploreClear').addEventListener('click', () => {
        el('#exploreSearch').value = '';
        state.explore.filtered = [];
        renderExplore(true);
      });
      el('#exploreLoadMore').addEventListener('click', () => renderExplore(false));

      // Buscar no topo (texto + clique na lupa)
      function showSearchResults(query) {
        const q = (query || '').toLowerCase().trim();
        const box = el('#searchResults');
        if (!box) return;
        if (!q) {
          box.innerHTML = '<div class="p-3 text-sm text-white/60">Digite para encontrar pessoas…</div>';
          box.classList.remove('hidden'); // abre com sugestão de digitar
          return;
        }
        const profiles = Object.values(state.users)
          .filter(u => (u.name + ' ' + u.handle).toLowerCase().includes(q))
          .slice(0, 12);
        box.classList.remove('hidden');
        box.innerHTML = profiles.length ? '' : '<div class="p-3 text-sm text-white/60">Nenhum perfil encontrado</div>';
        profiles.forEach(u => {
          const row = document.createElement('button');
          row.type = 'button';
          row.className = 'w-full text-left p-3 hover:bg-white/10 flex items-center gap-3';
          row.setAttribute('data-handle', u.handle);
          row.innerHTML = `
            <div class='w-9 h-9 rounded-full bg-gradient-to-br ${u.color.join(' ')} grid place-items-center text-white font-bold text-xs'>${u.initials}</div>
            <div class='min-w-0'>
              <p class='font-semibold text-white truncate'>${u.name}</p>
              <p class='text-xs text-white/60 truncate'>${u.handle}</p>
            </div>
            <div class='ml-auto ${u.following ? 'text-emerald-400' : 'text-white/60'} text-xs'>${u.following ? 'Seguindo' : ''}</div>
          `;
          row.addEventListener('click', () => { box.classList.add('hidden'); openProfile(u.handle); });
          box.appendChild(row);
        });
      }
      el('#searchInput')?.addEventListener('input', (e) => showSearchResults(e.target.value));
      el('#searchIconBtn')?.addEventListener('click', () => showSearchResults(el('#searchInput')?.value || ''));
      document.addEventListener('click', (e) => {
        const box = el('#searchResults'); const input = el('#searchInput'); const btn = el('#searchIconBtn');
        if (!box || !input) return;
        if (!box.contains(e.target) && e.target !== input && e.target !== btn) box.classList.add('hidden');
      });

      // Seguir/Deixar de seguir (Explorar, Sugestões, Resultados do feed/pesquisa)
      document.addEventListener('click', (e) => {
        const open = e.target.closest('button[data-action="open-profile"]');
        if (open) { openProfile(open.getAttribute('data-handle')); return; }

        const followBtn = e.target.closest('button[data-action="follow-user"]');
        if (followBtn) {
          const handle = followBtn.getAttribute('data-handle');
          const u = state.users[handle];
          if (!u) return;
          u.following = !u.following;
          followBtn.textContent = u.following ? 'Seguindo' : 'Seguir';
          followBtn.className = `px-3 py-1.5 rounded-lg ${u.following ? 'bg-white/20 text-white' : 'brand-gradient text-white'} font-semibold hover:brightness-110 active:brightness-95 transition`;

          // Atualiza contadores e feed para incluir posts dessa pessoa
          updateSidebarCounts();
          renderFeed();
          return;
        }
      });

      // Composer
      const composer = el('#composer');
      const btnPublish = el('#btnPublish');
      const charCount = el('#charCount');
      composer.addEventListener('input', () => {
        const len = composer.value.trim().length;
        charCount.textContent = `${len}/${state.charLimit}`;
        btnPublish.disabled = len === 0 || len > state.charLimit;
      });
      btnPublish.addEventListener('click', () => {
        const text = composer.value.trim();
        if (!text || text.length > state.charLimit) return;
        state.posts.unshift({
          id: 'p' + Date.now(),
          author: { name: 'Ítalo Paulo', handle: '@voce', initials: 'IP', color: ['from-purple-500','to-cyan-500'] },
          time: 'agora',
          text,
          likes: 0,
          liked: false,
          commentsOpen: false,
          comments: []
        });
        composer.value = '';
        charCount.textContent = `0/${state.charLimit}`;
        btnPublish.disabled = true;
        updateSidebarCounts();
        renderFeed();
      });

      // Interações do Feed
      el('#feed').addEventListener('click', (e) => {
        const btn = e.target.closest('button'); if (!btn) return;
        const card = e.target.closest('article[data-id]'); const action = btn.getAttribute('data-action');

        if (action === 'like') {
          const id = card.getAttribute('data-id');
          const post = state.posts.find(p => p.id === id) || state.globalPosts.find(p => p.id === id);
          if (!post) return;
          post.liked = !post.liked;
          post.likes += post.liked ? 1 : -1;
          btn.className = `px-3 py-1.5 rounded-lg ${post.liked ? 'bg-white/20 text-white' : 'bg-white/10 text-white/90'} hover:bg-white/20 transition`;
          btn.innerHTML = `${post.liked ? '❤️' : '🤍'} <span class="ml-1" data-like-count>${post.likes}</span>`;
        }

        if (action === 'comment-toggle') {
          const id = card.getAttribute('data-id');
          const post = state.posts.find(p => p.id === id) || state.globalPosts.find(p => p.id === id);
          if (!post) return;
          post.commentsOpen = !post.commentsOpen;
          card.querySelector('[data-comments]').classList.toggle('hidden', !post.commentsOpen);
        }

        if (action === 'add-comment') {
          const id = card.getAttribute('data-id');
          const post = state.posts.find(p => p.id === id) || state.globalPosts.find(p => p.id === id);
          const input = card.querySelector('[data-comment-input]');
          const txt = input.value.trim();
          if (!txt) return;
          post.comments.push({ id: 'c'+Date.now(), author: 'Você', text: txt });
          input.value = '';
          const list = card.querySelector('[data-comments-list]');
          const item = document.createElement('div');
          item.className = 'flex items-start gap-3';
          item.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-white/10 grid place-items-center text-white/80 text-xs">👤</div>
            <div class="flex-1 bg-white/5 rounded-xl p-3">
              <p class="text-sm"><span class="font-semibold">Você</span> ${txt}</p>
            </div>`;
          list.appendChild(item);
          const toggleBtn = card.querySelector('button[data-action="comment-toggle"]');
          toggleBtn.innerHTML = `💬 Comentários <span class="ml-1 text-white/70">(${post.comments.length})</span>`;
        }
      });

      // Notificações
      el('#notificationsList').addEventListener('click', (e) => {
        const row = e.target.closest('[data-id]'); if (!row) return;
        const id = row.getAttribute('data-id');
        const n = state.notifications.find(x => x.id === id);
        const toggleBtn = e.target.closest('button[data-action="read-toggle"]');
        if (toggleBtn) n.read = !n.read; else if (!n.read) n.read = true;
        state.unread = state.notifications.filter(x => !x.read).length;
        renderNotifications();
      });
      el('#markAllRead').addEventListener('click', () => {
        state.notifications.forEach(n => n.read = true);
        state.unread = 0;
        renderNotifications();
      });
      el('#btnFollowBackAll').addEventListener('click', () => {
        const followerNotifs = state.notifications.filter(n => n.text.includes('começou a seguir você'));
        followerNotifs.forEach(n => {
          const whoName = n.text.replace(' começou a seguir você','').trim();
          const u = Object.values(state.users).find(x => x.name === whoName);
          if (u && !u.following) u.following = true;
        });
        updateSidebarCounts();
        renderFollowersToFollow();
        renderFeed();
      });

      // Perfil próprio e voltar
      el('#viewOwnProfile').addEventListener('click', () => openProfile('@voce'));
      el('#btnProfileAvatar').addEventListener('click', () => openProfile('@voce'));
      el('#btnProfile').addEventListener('click', (e) => {
        const target = e.target.closest('[data-action="open-profile"]');
        if (target) openProfile(target.getAttribute('data-handle'));
      });
      el('#backArrow').addEventListener('click', () => {
        el('#profileView').classList.add('hidden');
        el('#exploreView').classList.add('hidden');
        el('#composerCard').classList.remove('hidden');
        el('#feed').classList.remove('hidden');
        el('#backArrow').classList.add('hidden');
      });

      // ESC fecha painéis
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          togglePanel('panelMessages', false);
          togglePanel('panelNotifications', false);
        }
      });
    }

    function init() {
      generateRandomUsers(2000); // milhares de perfis
      renderFeed();
      renderSuggestions();
      renderNotifications();
      updateSidebarCounts();
      setupEvents();

      // Notificações automáticas de novos seguidores a cada 30s
      setInterval(() => {
        const candidates = Object.values(state.users).filter(u => u.handle !== '@voce');
        if (candidates.length === 0) return;
        const who = candidates[Math.floor(Math.random() * candidates.length)];
        state.users['@voce'].followers = Math.max(0, (state.users['@voce'].followers || 0) + 1);
        state.notifications.unshift({ id: 'n'+Date.now(), text: `${who.name} começou a seguir você`, time: 'agora', read: false });
        state.unread++;
        renderNotifications();
        renderFollowersToFollow();
        updateFollowersUI();
      }, 30000);
    }
    init();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98003412839f3256',t:'MTc1ODAyNDAyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
